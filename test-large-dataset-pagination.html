<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TableCrafter Large Dataset Pagination Test</title>
    <link rel="stylesheet" href="assets/css/tablecrafter.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 40px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            background: #fafbfc;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        .test-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .performance-indicator {
            background: #e7f3ff;
            border: 1px solid #b3d8ff;
            padding: 10px 15px;
            border-radius: 4px;
            margin: 15px 0;
            font-size: 14px;
        }
        .performance-indicator.optimized {
            background: #e6f7ff;
            border-color: #91d5ff;
            color: #1890ff;
        }
        .performance-indicator.warning {
            background: #fff7e6;
            border-color: #ffd591;
            color: #d48806;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .metric-label {
            font-weight: 500;
        }
        .metric-value {
            color: #666;
        }
        .status-good { color: #52c41a; }
        .status-warning { color: #faad14; }
        .status-error { color: #f5222d; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>TableCrafter Large Dataset Pagination Test</h1>
        <p>Testing intelligent dataset optimization and enhanced pagination features.</p>

        <!-- Test 1: Small Dataset (No Optimization) -->
        <div class="test-section">
            <div class="test-title">Test 1: Small Dataset (100 rows)</div>
            <div class="test-description">
                Should use simple pagination with basic controls. No optimization needed.
            </div>
            <div id="small-dataset-table"></div>
            <div class="test-results" id="small-dataset-results"></div>
        </div>

        <!-- Test 2: Medium Dataset (1,500 rows) -->
        <div class="test-section">
            <div class="test-title">Test 2: Medium Dataset (1,500 rows)</div>
            <div class="test-description">
                Should auto-enable optimizations: pagination enabled, performance indicator, page size controls.
            </div>
            <div id="medium-dataset-table"></div>
            <div class="test-results" id="medium-dataset-results"></div>
        </div>

        <!-- Test 3: Large Dataset (5,000 rows) -->
        <div class="test-section">
            <div class="test-title">Test 3: Large Dataset (5,000 rows)</div>
            <div class="test-description">
                Should show enhanced pagination: first/last buttons, jump-to-page input, page size selector.
            </div>
            <div id="large-dataset-table"></div>
            <div class="test-results" id="large-dataset-results"></div>
        </div>

        <!-- Test 4: Very Large Dataset (10,000 rows) -->
        <div class="test-section">
            <div class="test-title">Test 4: Very Large Dataset (10,000 rows)</div>
            <div class="test-description">
                Should show performance warning and all enhanced controls. Check console for optimization messages.
            </div>
            <div id="very-large-dataset-table"></div>
            <div class="test-results" id="very-large-dataset-results"></div>
        </div>
    </div>

    <script src="assets/js/tablecrafter.js"></script>
    <script>
        // Test Data Generator
        function generateTestData(count, prefix = 'Item') {
            const data = [];
            const departments = ['Engineering', 'Sales', 'Marketing', 'Support', 'Finance', 'Operations'];
            const locations = ['New York', 'San Francisco', 'London', 'Tokyo', 'Berlin', 'Sydney'];
            
            for (let i = 1; i <= count; i++) {
                data.push({
                    id: i,
                    name: `${prefix} ${i}`,
                    department: departments[Math.floor(Math.random() * departments.length)],
                    location: locations[Math.floor(Math.random() * locations.length)],
                    salary: Math.floor(Math.random() * 100000) + 50000,
                    hire_date: new Date(2020 + Math.floor(Math.random() * 4), Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1).toISOString().split('T')[0],
                    status: Math.random() > 0.2 ? 'Active' : 'Inactive'
                });
            }
            return data;
        }

        // Columns configuration
        const columns = [
            { field: 'id', title: 'ID', sortable: true },
            { field: 'name', title: 'Name', sortable: true },
            { field: 'department', title: 'Department', sortable: true },
            { field: 'location', title: 'Location', sortable: true },
            { field: 'salary', title: 'Salary', sortable: true, type: 'currency' },
            { field: 'hire_date', title: 'Hire Date', sortable: true, type: 'date' },
            { field: 'status', title: 'Status', sortable: true }
        ];

        // Test Helper Functions
        function analyzeTable(tableInstance, resultElementId, expectedFeatures = {}) {
            const container = tableInstance.container;
            const pagination = container.querySelector('.tc-pagination');
            const paginationInfo = container.querySelector('.tc-pagination-info');
            const firstBtn = container.querySelector('.tc-first-btn');
            const lastBtn = container.querySelector('.tc-last-btn');
            const pageJump = container.querySelector('.tc-page-jump');
            const pageSizeControls = container.querySelector('.tc-page-size-controls');
            
            const results = {
                dataSize: tableInstance.data.length,
                paginationEnabled: tableInstance.config.pagination,
                pageSize: tableInstance.config.pageSize,
                hasOptimizationIndicator: paginationInfo?.title?.includes('optimization') || false,
                hasFirstLastButtons: !!(firstBtn && lastBtn),
                hasPageJump: !!pageJump,
                hasPageSizeControls: !!pageSizeControls,
                largeDatasetOptimization: tableInstance.config.largeDataset.serverSide
            };

            // Display results
            const resultElement = document.getElementById(resultElementId);
            resultElement.innerHTML = `
                <div class="metric">
                    <span class="metric-label">Data Size:</span>
                    <span class="metric-value">${results.dataSize.toLocaleString()} rows</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Pagination Enabled:</span>
                    <span class="metric-value ${results.paginationEnabled ? 'status-good' : 'status-error'}">
                        ${results.paginationEnabled ? 'âœ“ Yes' : 'âœ— No'}
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">Page Size:</span>
                    <span class="metric-value">${results.pageSize} rows</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Optimization Indicator:</span>
                    <span class="metric-value ${results.hasOptimizationIndicator ? 'status-good' : 'status-warning'}">
                        ${results.hasOptimizationIndicator ? 'âœ“ Shown' : '- Not shown'}
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">First/Last Buttons:</span>
                    <span class="metric-value ${results.hasFirstLastButtons ? 'status-good' : 'status-warning'}">
                        ${results.hasFirstLastButtons ? 'âœ“ Present' : '- Not present'}
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">Page Jump Input:</span>
                    <span class="metric-value ${results.hasPageJump ? 'status-good' : 'status-warning'}">
                        ${results.hasPageJump ? 'âœ“ Present' : '- Not present'}
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">Page Size Controls:</span>
                    <span class="metric-value ${results.hasPageSizeControls ? 'status-good' : 'status-warning'}">
                        ${results.hasPageSizeControls ? 'âœ“ Present' : '- Not present'}
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">Large Dataset Mode:</span>
                    <span class="metric-value ${results.largeDatasetOptimization ? 'status-good' : 'status-warning'}">
                        ${results.largeDatasetOptimization ? 'âœ“ Enabled' : '- Disabled'}
                    </span>
                </div>
            `;

            return results;
        }

        // Console logging override to capture optimization messages
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const logMessages = [];

        console.log = function(...args) {
            if (args[0] && args[0].includes && args[0].includes('TableCrafter:')) {
                logMessages.push({ type: 'log', message: args[0] });
            }
            originalConsoleLog.apply(console, args);
        };

        console.warn = function(...args) {
            if (args[0] && args[0].includes && args[0].includes('TableCrafter:')) {
                logMessages.push({ type: 'warn', message: args[0] });
            }
            originalConsoleWarn.apply(console, args);
        };

        // Initialize Tests
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸ§ª Starting TableCrafter Large Dataset Pagination Tests');

            // Test 1: Small Dataset (100 rows)
            const smallData = generateTestData(100, 'Employee');
            const smallTable = new TableCrafter('#small-dataset-table', {
                data: smallData,
                columns: columns,
                filterable: true,
                globalSearch: true
            });
            
            setTimeout(() => {
                analyzeTable(smallTable, 'small-dataset-results');
            }, 100);

            // Test 2: Medium Dataset (1,500 rows)  
            const mediumData = generateTestData(1500, 'Employee');
            const mediumTable = new TableCrafter('#medium-dataset-table', {
                data: mediumData,
                columns: columns,
                filterable: true,
                globalSearch: true
            });

            setTimeout(() => {
                analyzeTable(mediumTable, 'medium-dataset-results');
            }, 200);

            // Test 3: Large Dataset (5,000 rows)
            const largeData = generateTestData(5000, 'Employee');
            const largeTable = new TableCrafter('#large-dataset-table', {
                data: largeData,
                columns: columns,
                filterable: true,
                globalSearch: true
            });

            setTimeout(() => {
                analyzeTable(largeTable, 'large-dataset-results');
            }, 300);

            // Test 4: Very Large Dataset (10,000 rows)
            const veryLargeData = generateTestData(10000, 'Employee');
            const veryLargeTable = new TableCrafter('#very-large-dataset-table', {
                data: veryLargeData,
                columns: columns,
                filterable: true,
                globalSearch: true
            });

            setTimeout(() => {
                analyzeTable(veryLargeTable, 'very-large-dataset-results');
                
                // Show captured console messages
                setTimeout(() => {
                    if (logMessages.length > 0) {
                        const messageContainer = document.createElement('div');
                        messageContainer.className = 'performance-indicator';
                        messageContainer.innerHTML = '<strong>Console Messages:</strong><br>' + 
                            logMessages.map(msg => `${msg.type.toUpperCase()}: ${msg.message}`).join('<br>');
                        document.querySelector('.test-container').appendChild(messageContainer);
                    }
                }, 100);
            }, 400);

            console.log('ðŸŽ‰ All tests initialized. Check the results above.');
        });
    </script>
</body>
</html>